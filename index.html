<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ODIN BOSS COMMAND CENTER</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;500;700&family=Orbitron:wght@600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #f4f7f9; --sidebar-bg: #ffffff; --primary: #8e24aa;
            --accent: #1e88e5; --text-main: #333; --text-muted: #777;
            --card-bg: #ffffff; --danger: #e53935; --success: #43a047;
        }

        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg-body); color: var(--text-main); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* ì‚¬ì´ë“œë°” */
        nav { width: 70px; background: var(--sidebar-bg); border-right: 1px solid #ddd; display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 20px; z-index: 100; }
        nav .nav-item { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; color: var(--text-muted); transition: 0.3s; font-size: 20px; }
        nav .nav-item:hover { background: #f0f0f0; color: var(--primary); }
        nav .nav-item.active { background: var(--primary); color: white; }

        /* ë©”ì¸ ì½˜í…ì¸  */
        main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        header { height: 60px; background: white; border-bottom: 1px solid #ddd; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2em; position: relative; }
        .power-btn { position: absolute; right: 20px; color: var(--success); cursor: pointer; }

        .content-area { flex: 1; padding: 25px; overflow-y: auto; }
        .pane { display: none; animation: fadeIn 0.3s ease; }
        .pane.active { display: block; }

        /* ì¹´ë“œ ë° ë ˆì´ì•„ì›ƒ */
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); padding: 20px; margin-bottom: 20px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        /* ëŒ€ì‹œë³´ë“œ */
        .next-boss-focus { text-align: center; border: 2px solid var(--accent); padding: 30px; }
        .next-boss-name { font-size: 1.5em; color: var(--accent); font-weight: bold; }
        .timer-big { font-size: 3.5em; font-family: 'Orbitron', sans-serif; margin: 10px 0; }

        /* ìŠ¤ì¼€ì¤„ëŸ¬ í…Œì´ë¸” */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; padding: 12px; border-bottom: 2px solid #eee; color: var(--text-muted); font-size: 0.9em; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        .world-tag { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; margin-bottom: 5px; color: white; }
        
        input[type="number"] { width: 80px; padding: 6px; border: 1px solid #ddd; border-radius: 4px; text-align: center; }

        /* ì›”ë“œë³„ ìƒ‰ìƒ */
        .w-jotun { background: #5c6bc0; } .w-nida { background: #66bb6a; } .w-alf { background: #ffa726; }
        .w-muspel { background: #ef5350; } .w-as { background: #ab47bc; } .w-nifl { background: #26c6da; }
        .w-vana { background: #9ccc65; } .w-dun { background: #78909c; }

        /* ë¡œê·¸ */
        .log-list { font-size: 0.9em; max-height: 200px; overflow-y: auto; }
        .log-item { padding: 5px 0; border-bottom: 1px dashed #eee; }
        .log-time { color: var(--danger); font-weight: bold; margin-right: 10px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<nav>
    <div class="nav-item active" onclick="showPane('home')">ğŸ </div>
    <div class="nav-item" onclick="showPane('schedule')">ğŸ“…</div>
    <div class="nav-item" onclick="showPane('calc')">ğŸ§®</div>
    <div class="nav-item" onclick="showPane('logs')">ğŸ“</div>
    <div class="nav-item" onclick="showPane('settings')">âš™ï¸</div>
    <div class="nav-item" onclick="togglePIP()">ğŸ“º</div>
</nav>

<main>
    <header>ë³´ìŠ¤ ì•Œë¦¬ë¯¸ <span class="power-btn">â»</span></header>
    
    <div class="content-area">
        <div id="home" class="pane active">
            <div class="grid-2">
                <div class="card next-boss-focus">
                    <p style="margin:0; color:var(--text-muted)">ë‹¤ìŒ ë³´ìŠ¤</p>
                    <div id="next-boss-info">
                        <div class="next-boss-name">[--:--] ëŒ€ê¸° ì¤‘</div>
                        <div class="timer-big">00:00:00</div>
                    </div>
                </div>
                <div>
                    <div class="card">
                        <p style="margin:0; font-weight:bold;">ì•Œë¦¼ ìƒíƒœ: <span style="color:var(--danger)">ì•Œë¦¼ ì‹¤í–‰ ì¤‘</span></p>
                        <div style="margin-top:15px;">
                            ì†Œë¦¬ ì„¤ì •: <input type="range" min="0" max="1" step="0.1" value="0.5">
                        </div>
                    </div>
                    <div class="card">
                        <p style="margin:0; font-weight:bold; margin-bottom:10px;">ë¡œê·¸</p>
                        <div class="log-list" id="dashboard-logs"></div>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3>ë‹¤ê°€ì˜¤ëŠ” ë³´ìŠ¤</h3>
                <div id="upcoming-list"></div>
            </div>
        </div>

        <div id="schedule" class="pane">
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2>ë³´ìŠ¤ ìŠ¤ì¼€ì¤„ëŸ¬</h2>
                    <button onclick="saveAllTimers()" style="background:var(--primary); color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">ë³´ìŠ¤ ì„¤ì • ì ìš©</button>
                </div>
                <table>
                    <thead>
                        <tr><th>ë³´ìŠ¤ ì •ë³´</th><th>ë‚¨ì€ ì‹œê°„(ë¶„)</th><th>ì˜ˆìƒ ì   ì‹œê°„</th></tr>
                    </thead>
                    <tbody id="scheduler-body"></tbody>
                </table>
            </div>
        </div>

        <div id="logs" class="pane">
            <div class="card">
                <h2>ì´ë²¤íŠ¸ ë¡œê·¸</h2>
                <div id="full-log-list"></div>
            </div>
        </div>
    </div>
</main>

<canvas id="pip-canvas" width="300" height="400" style="display:none;"></canvas>
<video id="pip-video" autoplay muted style="display:none;"></video>

<script>
    // 1. ìš”ì²­í•˜ì‹  ìˆœì„œëŒ€ë¡œ ë³´ìŠ¤ ë°ì´í„° êµ¬ì„± (ìš”íˆ°~ë°”ë‚˜~ë˜ì „)
    const bossList = [
        { world: "ìš”íˆ°í—¤ì„", color: "w-jotun", name: "íŒŒë¥´ë°”", regen: 120 },
        { world: "ìš”íˆ°í—¤ì„", color: "w-jotun", name: "ë°”ìš°í‹°", regen: 120 },
        { world: "ë‹ˆë‹¤ë²¨ë¦¬ë¥´", color: "w-nida", name: "í˜í‹°", regen: 720 },
        { world: "ë‹ˆë‹¤ë²¨ë¦¬ë¥´", color: "w-nida", name: "ìˆ˜ë“œë¦¬", regen: 720 },
        { world: "ì•Œë¸Œí—¤ì„", color: "w-alf", name: "ì…€ë¡œë¹„ì•„", regen: 720 },
        { world: "ì•Œë¸Œí—¤ì„", color: "w-alf", name: "íë‹ˆë¥´", regen: 720 },
        { world: "ë¬´ìŠ¤í í—¤ì„", color: "w-muspel", name: "ìˆ˜ë¥´íŠ¸", regen: 1440 },
        { world: "ë¬´ìŠ¤í í—¤ì„", color: "w-muspel", name: "ì‹ ë§ˆë¼", regen: 720 },
        { world: "ì•„ìŠ¤ê°€ë¥´ë“œ", color: "w-as", name: "ì˜¤ë”˜", regen: 1440 },
        { world: "ì•„ìŠ¤ê°€ë¥´ë“œ", color: "w-as", name: "í‹°ë¥´", regen: 1440 },
        { world: "ë‹ˆí”Œí—¤ì„", color: "w-nifl", name: "ë‹ˆë“œí˜¸ê·¸", regen: 1440 },
        { world: "ë°”ë‚˜í—¤ì„", color: "w-vana", name: "êµ´ë² ì´ê·¸", regen: 480 },
        { world: "ë˜ì „", color: "w-dun", name: "ì§€ê°7ì¸µ", regen: 480 },
        { world: "ë˜ì „", color: "w-dun", name: "ì§€ê°4ì¸µ", regen: 480 }
    ];

    let activeTimers = JSON.parse(localStorage.getItem('odin_pro_timers')) || [];
    let logs = [];

    // íƒ­ ì „í™˜
    function showPane(id) {
        document.querySelectorAll('.pane').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // ìŠ¤ì¼€ì¤„ëŸ¬ ë Œë”ë§
    function initScheduler() {
        const body = document.getElementById('scheduler-body');
        bossList.forEach((boss, idx) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><span class="world-tag ${boss.color}">${boss.world}</span><br><strong>${boss.name}</strong></td>
                <td><input type="number" id="input-${idx}" placeholder="ë¶„"></td>
                <td id="target-${idx}">--:--:--</td>
            `;
            body.appendChild(tr);
        });
    }

    // íƒ€ì´ë¨¸ ì €ì¥
    function saveAllTimers() {
        bossList.forEach((boss, idx) => {
            const val = document.getElementById(`input-${idx}`).value;
            if(val) {
                const target = Date.now() + (val * 60000);
                const existing = activeTimers.findIndex(t => t.name === boss.name);
                if(existing > -1) activeTimers[existing].target = target;
                else activeTimers.push({ name: boss.name, target, world: boss.world });
                addLog(`${boss.name} íƒ€ì´ë¨¸ ì„¤ì •ë¨`);
            }
        });
        localStorage.setItem('odin_pro_timers', JSON.stringify(activeTimers));
        alert("ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    // ë¡œê·¸ ì¶”ê°€
    function addLog(msg) {
        const now = new Date();
        const timeStr = `[${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}]`;
        logs.unshift({ time: timeStr, msg });
        updateLogUI();
    }

    function updateLogUI() {
        const dashLog = document.getElementById('dashboard-logs');
        dashLog.innerHTML = logs.slice(0, 5).map(l => `<div class="log-item"><span class="log-time">${l.time}</span> ${l.msg}</div>`).join('');
    }

    // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (1ì´ˆë§ˆë‹¤)
    function updateLoop() {
        const now = Date.now();
        activeTimers.sort((a,b) => a.target - b.target);
        activeTimers = activeTimers.filter(t => t.target - now > -600000);

        if(activeTimers.length > 0) {
            const next = activeTimers[0];
            const diff = next.target - now;
            document.querySelector('.next-boss-name').innerText = `[${next.world}] ${next.name}`;
            document.querySelector('.timer-big').innerText = formatDiff(diff);
            
            // ì•Œë¦¼ ë¡œì§ (ì˜ˆ: 1ë¶„ ì „)
            if(Math.floor(diff/1000) === 60) addLog(`${next.name} 1ë¶„ ì „ì…ë‹ˆë‹¤!`);
        }

        // ë‹¤ê°€ì˜¤ëŠ” ë¦¬ìŠ¤íŠ¸
        document.getElementById('upcoming-list').innerHTML = activeTimers.slice(1, 6).map(t => `
            <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee;">
                <span><strong>${t.name}</strong> (${t.world})</span>
                <span style="color:var(--primary)">${formatDiff(t.target - now)}</span>
            </div>
        `).join('');

        drawPIP();
    }

    function formatDiff(ms) {
        if(ms < 0) return "ì¶œí˜„ ì¤‘";
        const h = Math.floor(ms / 3600000);
        const m = Math.floor((ms % 3600000) / 60000);
        const s = Math.floor((ms % 60000) / 1000);
        return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    // PIP ë° ê¸°íƒ€ ê¸°ëŠ¥ (ìƒëµëœ ë””ìì¸ ë¡œì§ì€ ìœ ì§€)
    const canvas = document.getElementById('pip-canvas');
    const ctx = canvas.getContext('2d');
    function drawPIP() {
        ctx.fillStyle = "#1a1d24"; ctx.fillRect(0,0,300,400);
        ctx.fillStyle = "#8e24aa"; ctx.font = "bold 18px Arial"; ctx.fillText("BOSS ALARM", 15, 35);
        activeTimers.slice(0, 7).forEach((t, i) => {
            const d = t.target - Date.now();
            ctx.fillStyle = d < 300000 ? "red" : "white";
            ctx.font = "16px Arial";
            ctx.fillText(`${t.name.padEnd(6)} ${formatDiff(d)}`, 15, 75 + (i * 35));
        });
    }

    async function togglePIP() {
        const v = document.getElementById('pip-video');
        if (document.pictureInPictureElement) await document.exitPictureInPicture();
        else { v.srcObject = canvas.captureStream(); await v.play(); await v.requestPictureInPicture(); }
    }

    initScheduler();
    setInterval(updateLoop, 1000);
</script>

</body>
</html>
