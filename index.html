<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ODIN BOSS COMMANDER - PRECISION</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8e24aa; --accent: #1e88e5; --bg: #f8f9fa;
            --card: #ffffff; --text: #2c3e50; --danger: #d32f2f;
            --jotun: #3f51b5; --nida: #43a047; --alf: #ef6c00; --muspel: #c62828;
            --as: #7b1fa2; --nifl: #0097a7; --vana: #689f38; --dun: #455a64;
        }

        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        nav { width: 70px; background: #fff; border-right: 1px solid #dee2e6; display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 15px; }
        .nav-item { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 12px; cursor: pointer; color: #95a5a6; transition: 0.2s; font-size: 20px; }
        .nav-item.active { background: var(--primary); color: #fff; box-shadow: 0 4px 10px rgba(142, 36, 170, 0.3); }
        main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        header { height: 50px; background: #fff; border-bottom: 1px solid #dee2e6; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--primary); }
        .content { flex: 1; padding: 20px; overflow-y: auto; }
        .pane { display: none; }
        .pane.active { display: block; }

        /* ÎåÄÏãúÎ≥¥Îìú */
        .dashboard-layout { display: grid; grid-template-columns: 1fr 320px; gap: 20px; }
        .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); margin-bottom: 20px; }
        .timer-main { font-family: 'Orbitron', sans-serif; font-size: 3.5em; color: var(--accent); margin: 10px 0; text-align: center; }

        /* Ïä§ÏºÄÏ§ÑÎü¨ */
        .world-badge { padding: 4px 10px; border-radius: 4px; color: #fff; font-weight: bold; font-size: 0.8em; margin: 15px 0 5px 0; display: inline-block; }
        table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 8px; overflow: hidden; margin-bottom: 10px; }
        td { padding: 12px; border-bottom: 1px solid #f1f3f5; }
        .b-name { width: 140px; font-weight: 700; }
        .btn-killed { background: var(--danger); color: #fff; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 0.85em; font-weight: bold; }
        
        /* ÏûÖÎ†•Ï∞Ω ÎîîÏûêÏù∏ Í∞úÏÑ† */
        input[type="text"] { width: 110px; padding: 8px; border: 2px solid #e9ecef; border-radius: 6px; text-align: center; font-family: 'Orbitron'; font-weight: bold; color: var(--primary); }
        input:focus { border-color: var(--primary); outline: none; background: #fdf2ff; }
        .exp-time { font-family: monospace; color: #7f8c8d; font-size: 0.9em; font-weight: bold; }

        .log-box { height: 350px; overflow-y: auto; font-size: 0.85em; background: #fafafa; padding: 10px; border-radius: 8px; }
        .log-line { border-bottom: 1px solid #eee; padding: 4px 0; }
    </style>
</head>
<body>

<nav>
    <div class="nav-item active" onclick="tab('dash')">üè†</div>
    <div class="nav-item" onclick="tab('sched')">üìÖ</div>
    <div class="nav-item" onclick="togglePIP()">üì∫</div>
</nav>

<main>
    <header>ODIN COMMANDER: PRECISION</header>
    <div class="content">
        <div id="dash" class="pane active">
            <div class="dashboard-layout">
                <div>
                    <div class="card" style="border-top: 4px solid var(--accent);">
                        <div style="text-align:center; font-weight:bold; color:#666;">NEXT BOSS</div>
                        <div id="m-name" style="font-size:1.8em; font-weight:bold; text-align:center; margin-top:10px;">--</div>
                        <div id="m-timer" class="timer-main">00:00:00</div>
                    </div>
                    <div class="card">
                        <h3 style="margin-top:0;">Upcoming Schedule</h3>
                        <div id="up-list"></div>
                    </div>
                </div>
                <div class="card">
                    <h3 style="margin-top:0;">Activity Logs</h3>
                    <div id="log-box" class="log-box"></div>
                </div>
            </div>
        </div>

        <div id="sched" class="pane">
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h2 style="margin:0;">World Boss Scheduler</h2>
                    <span style="font-size:0.8em; color:var(--primary);">* ÏûÖÎ†• ÏòàÏãú: '1 20'(1ÏãúÍ∞Ñ20Î∂Ñ), '15:30'(15Î∂Ñ30Ï¥à), '60'(60Î∂Ñ)</span>
                </div>
                <div id="sched-body"></div>
            </div>
        </div>
    </div>
</main>

<canvas id="pip-canvas" width="300" height="300" style="display:none;"></canvas>
<video id="pip-video" autoplay muted style="display:none;"></video>

<script>
    // 53Ï¢Ö Î≥¥Ïä§ Îç∞Ïù¥ÌÑ∞ Î∞è Î¶¨Ï†† Ï£ºÍ∏∞(Î∂Ñ)
    const bossDB = [
        { w: "ÏöîÌà∞Ìó§ÏûÑ", c: "var(--jotun)", b: [
            {n:"ÌååÎ•¥Î∞î", r:120}, {n:"ÏÖÄÎ°úÎπÑÏïÑ", r:720}, {n:"ÌùêÎãàÎ•¥", r:720}, {n:"ÌéòÌã∞", r:720}, 
            {n:"Î∞îÏö∞Ìã∞", r:120}, {n:"ÎãàÎìúÌò∏Í∑∏", r:1440}, {n:"ÏïºÎ£¨", r:240}, {n:"Ìã∞Î•¥", r:1440}
        ]},
        { w: "ÎãàÎã§Î≤®Î¶¨Î•¥", c: "var(--nida)", b: [
            {n:"ÎùºÏù¥ÎÖ∏Î•¥", r:720}, {n:"ÎπÑÏöîÎ•∏", r:720}, {n:"Ìó§Î•¥Î™®Îìú", r:240}, {n:"Ïä§ÏπºÎùºÎãàÎ•¥", r:120}, 
            {n:"Î∏åÎ•ÄÌûêÎìú", r:720}, {n:"ÎùºÌÉÄÌÜ†Ïä§ÌÅ¨", r:240}, {n:"ÏàòÎìúÎ¶¨", r:720}, {n:"ÌÜ†Î•¥", r:1440}
        ]},
        { w: "ÏïåÎ∏åÌó§ÏûÑ", c: "var(--alf)", b: [
            {n:"Ïä§Î∞îÎ•¥Ìä∏", r:240}, {n:"ÎëêÎùºÏä§Î°úÎ•¥", r:480}, {n:"Î™®ÎÑ§Í∞ÄÎ¶Ñ", r:120}, {n:"ÎìúÎùºÏö∞Í∑∏", r:240}, 
            {n:"Íµ¥Î≤†Ïù¥Í∑∏", r:480}, {n:"Ïò§Îîò", r:1440}
        ]},
        { w: "Î¨¥Ïä§Ìé†ÌïòÏûÑ", c: "var(--muspel)", b: [
            {n:"Î©îÍ∏∞Î•¥", r:120}, {n:"Ïã†ÎßàÎùº", r:720}, {n:"Ìó§Î•¥Í∞ÄÎ¶Ñ", r:120}, {n:"ÌÉïÍ∑∏Î¶¨Ïä§ÎãàÎ•¥", r:240}, 
            {n:"ÏóòÎìúÎ£¨", r:720}, {n:"Ïö∞Î°úÎ≥¥Î°úÏä§", r:1440}, {n:"ÏàòÎ•¥Ìä∏", r:1440}
        ]},
        { w: "ÏïÑÏä§Í∞ÄÎ•¥Îìú", c: "var(--as)", b: [
            {n:"Î∞úÎ¶¨", r:120}, {n:"ÎÖ∏Ìä∏", r:480}, {n:"ÏÉ§Î¨¥ÌÅ¨", r:120}, {n:"Ïä§ÏπºÎìúÎ©îÎ•¥", r:120}, 
            {n:"ÌôîÏã†Í∑∏Î°úÏïÑ", r:1440}, {n:"ÎØ∏ÎØ∏Î•¥", r:240}
        ]},
        { w: "ÎãàÌîåÌïòÏûÑ", c: "var(--nifl)", b: [
            {n:"ÌûàÎ°úÌÇ®", r:1440}, {n:"Ìò∏Îìú", r:1440}, {n:"Ìó§Ïù¥Îìú", r:1440}, {n:"ÎåÄÍµêÏ£º", r:1440}, 
            {n:"ÌîÑÎ†àÏù¥", r:1440}, {n:"Ïù¥ÎØ∏Î•¥", r:1440}
        ]},
        { w: "Î∞îÎÇòÌïòÏûÑ", c: "var(--vana)", b: [
            {n:"ÏóòÎîîÎ•¥", r:1440}, {n:"ÏïàÎÇòÎ•¥ÏóòÎîîÎ•¥", r:1440}, {n:"Ïä§Ïø®Îìú", r:1440}, {n:"Ïä§Ïπ¥Îîî", r:1440}, {n:"ÏóêÍ∏∞Î•¥", r:1440}
        ]},
        { w: "ÎçòÏ†Ñ", c: "var(--dun)", b: [
            {n:"ÏµúÌïòÏ∏µ Íµ¥Î≤†Ïù¥Í∑∏", r:480}, {n:"ÏµúÌïòÏ∏µ Í∞ïÍ∏ÄÎ°úÌã∞", r:480}, {n:"ÏµúÌïòÏ∏µ Ïä§ÎÑ§Î•¥", r:480}, 
            {n:"4Ï∏µ Î™®ÎÑ§Í∞ÄÎ¶Ñ", r:240}, {n:"7Ï∏µ ÎìúÎùºÏö∞Í∑∏", r:480}, {n:"10Ï∏µ Îã§Ïù∏ÌùòÎ°úÌÅ¨", r:480}
        ]}
    ];

    let timers = JSON.parse(localStorage.getItem('odin_precision_v3')) || [];

    function init() {
        const body = document.getElementById('sched-body');
        let html = '';
        bossDB.forEach(group => {
            html += `<div class="world-badge" style="background:${group.c}">${group.w}</div>`;
            html += `<table>`;
            group.b.forEach(boss => {
                const savedVal = localStorage.getItem(`input_val_${boss.n}`) || '';
                html += `
                    <tr>
                        <td class="b-name">${boss.n}</td>
                        <td style="width:75px;"><button class="btn-killed" onclick="autoSet('${boss.n}', ${boss.r})">Ïû°Ïùå</button></td>
                        <td><input type="text" class="b-in" data-name="${boss.n}" value="${savedVal}" placeholder="Ïãú Î∂Ñ Ï¥à"></td>
                        <td class="exp-time" id="exp-${boss.n}">--:--</td>
                    </tr>`;
            });
            html += `</table>`;
        });
        body.innerHTML = html;

        const ins = document.querySelectorAll('.b-in');
        ins.forEach((el, i) => {
            el.addEventListener('keydown', (e) => {
                if(e.key === 'Enter') {
                    const sec = parseTime(el.value);
                    if(sec > 0) {
                        manualSet(el.dataset.name, sec);
                        localStorage.setItem(`input_val_${el.dataset.name}`, el.value); // Í∞í Ïú†ÏßÄÏö© Ï†ÄÏû•
                    }
                    if(ins[i+1]) ins[i+1].focus();
                }
            });
        });
    }

    // ÏãúÍ∞Ñ ÌååÏã± Î°úÏßÅ (H:M:S, M:S, M Î™®Îëê ÎåÄÏùë)
    function parseTime(str) {
        if(!str) return 0;
        const p = str.split(/[:\s]+/).filter(x => x !== "").map(Number);
        if (p.some(isNaN)) return 0;
        if (p.length === 3) return (p[0] * 3600) + (p[1] * 60) + p[2]; // Ïãú:Î∂Ñ:Ï¥à -> Ï¥à
        if (p.length === 2) return (p[0] * 60) + p[1]; // Î∂Ñ:Ï¥à -> Ï¥à
        return p[0] * 60; // Î∂Ñ -> Ï¥à
    }

    function autoSet(name, regenMins) {
        const target = Date.now() + (regenMins * 60000);
        save(name, target, `[ÏûêÎèô] ${name} (${regenMins}Î∂Ñ Ï£ºÍ∏∞)`);
    }

    function manualSet(name, totalSec) {
        const target = Date.now() + (totalSec * 1000);
        save(name, target, `[ÏàòÎèô] ${name} (${Math.floor(totalSec/60)}Î∂Ñ ${totalSec%60}Ï¥à Îí§)`);
    }

    function save(name, target, logMsg) {
        const idx = timers.findIndex(t => t.n === name);
        if(idx > -1) timers[idx].t = target;
        else timers.push({ n: name, t: target });
        
        localStorage.setItem('odin_precision_v3', JSON.stringify(timers));
        document.getElementById(`exp-${name}`).innerText = new Date(target).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        addLog(logMsg);
    }

    function addLog(msg) {
        const box = document.getElementById('log-box');
        const now = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'});
        box.innerHTML = `<div class="log-line"><span style="color:var(--danger)">[${now}]</span> ${msg}</div>` + box.innerHTML;
    }

    function tab(id) {
        document.querySelectorAll('.pane').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function update() {
        const now = Date.now();
        timers.sort((a,b) => a.t - b.t);
        timers = timers.filter(timer => timer.t - now > -600000);

        if(timers.length > 0) {
            const next = timers[0];
            const diff = next.t - now;
            document.getElementById('m-name').innerText = next.n;
            document.getElementById('m-timer').innerText = format(diff);
            document.getElementById('m-timer').style.color = diff < 300000 ? 'var(--danger)' : 'var(--accent)';
        }

        document.getElementById('up-list').innerHTML = timers.slice(1, 10).map(t => `
            <div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #f1f3f5;">
                <span>${t.n}</span>
                <span style="font-weight:bold; color:var(--primary);">${format(t.t - now)}</span>
            </div>
        `).join('');

        drawPIP();
    }

    function format(ms) {
        if(ms < 0) return "APPEARED";
        const h = Math.floor(ms/3600000);
        const m = Math.floor((ms%3600000)/60000);
        const s = Math.floor((ms%60000)/1000);
        return `${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    const canvas = document.getElementById('pip-canvas');
    const ctx = canvas.getContext('2d');
    function drawPIP() {
        ctx.fillStyle = "#1e1e2e"; ctx.fillRect(0,0,300,300);
        ctx.fillStyle = "#8e24aa"; ctx.font = "bold 18px Orbitron"; ctx.fillText("ODIN PIP (5)", 15, 35);
        // ÏöîÏ≤≠ÎåÄÎ°ú ÏÉÅÏúÑ 5Í∞úÎßå ÌëúÏãú
        timers.slice(0, 5).forEach((t, i) => {
            const d = t.t - Date.now();
            ctx.fillStyle = d < 300000 ? "#ff1744" : "#00e5ff";
            ctx.font = "16px Noto Sans KR";
            ctx.fillText(`${t.n.substring(0,6).padEnd(6)} ${format(d)}`, 15, 75 + (i*40));
        });
    }

    async function togglePIP() {
        const v = document.getElementById('pip-video');
        if (document.pictureInPictureElement) await document.exitPictureInPicture();
        else { v.srcObject = canvas.captureStream(); await v.play(); await v.requestPictureInPicture(); }
    }

    init();
    setInterval(update, 1000);
</script>

</body>
</html>
