<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOSS OPS CENTER V32.18 HD FINAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@500;800&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary: #1a237e; --primary-light: #e8eaf6; --border: #dee2e6; --danger: #d32f2f; --warning: #ef6c00; }
        body { font-family: 'Inter', 'Noto Sans KR', sans-serif; background: #f4f5f7; margin: 0; display: flex; height: 100vh; overflow: hidden; font-size: 13px; }
        body.system-off .content { filter: grayscale(1) brightness(0.9); pointer-events: none; }
        header, nav { pointer-events: auto !important; }
        nav { width: 220px; background: #fff; border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 15px 0; z-index: 1000; flex-shrink: 0; }
        .nav-brand { padding: 0 25px 20px; font-weight: 900; font-size: 16px; color: var(--primary); border-bottom: 1px solid #f1f3f5; margin-bottom: 15px; }
        .nav-item { display: flex; align-items: center; padding: 12px 25px; cursor: pointer; color: #6c757d; transition: 0.2s; gap: 12px; font-weight: 700; }
        .nav-item.active { background: var(--primary-light); color: var(--primary); border-left: 4px solid var(--primary); }
        main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        header { height: 60px; background: #fff; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 25px; flex-shrink: 0; }
        .content { flex: 1; padding: 20px; overflow-y: auto; display: flex; justify-content: center; }
        .pane { display: none; width: 100%; max-width: 720px; animation: fadeIn 0.15s ease; }
        .pane.active { display: block; }
        .card { background: #fff; border-radius: 12px; border: 1px solid var(--border); padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .timer-big { font-family: 'JetBrains Mono'; font-size: 52px; font-weight: 800; color: var(--primary); margin: 10px 0; letter-spacing: -2px; }
        .timer-10m { color: #f59e0b !important; } .timer-5m { color: #ef4444 !important; } .timer-1m { color: #b91c1c !important; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .boss-row { display: grid; grid-template-columns: 35px 115px 1fr 100px 75px 35px; align-items: center; padding: 8px 15px; border-bottom: 1px solid #f1f3f5; gap: 8px; }
        .v-in { height: 30px; width: 100%; border-radius: 6px; border: 1px solid #ced4da; text-align: center; font-family: 'JetBrains Mono'; font-weight: 700; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: #fff; width: 90%; max-width: 800px; max-height: 85vh; overflow-y: auto; border-radius: 20px; padding: 30px; }
    </style>
</head>
<body onkeydown="handleKeys(event)">

<nav>
    <div class="nav-brand italic text-center text-blue-900 font-black uppercase tracking-tighter">B-OPS V32.18 HD</div>
    <div class="nav-item active" onclick="tab('dash', this)">üè† Dashboard</div>
    <div class="nav-item" onclick="tab('sched', this)">üìÖ Boss Schedule</div>
    <div class="nav-item" onclick="tab('calc', this)">üñ© Í≥ÑÏÇ∞Í∏∞ (Calculator)</div>
    <div class="nav-item" onclick="togglePIP()">üì∫ Toggle HD-PiP</div>
</nav>

<main>
    <header>
        <div class="flex gap-2 bg-gray-100 p-1 rounded-lg">
            <button class="p-btn active" data-p="A" onclick="switchProfile('A')">PROFILE A</button>
            <button class="p-btn" data-p="B" onclick="switchProfile('B')">PROFILE B</button>
        </div>
        <div class="flex items-center gap-4">
            <label class="flex items-center gap-2 cursor-pointer bg-green-50 px-3 py-1 rounded-full border border-green-200">
                <input type="checkbox" id="auto-rotate-mode" checked class="w-4 h-4 accent-green-600" onchange="st.autoRotate = this.checked; save();">
                <span class="text-[10px] font-black text-green-700">AUTO ROTATE</span>
            </label>
            <div id="pwr" class="cursor-pointer text-2xl text-green-600 font-bold" onclick="togglePwr()">‚èª</div>
        </div>
    </header>

    <div class="content">
        <div id="dash" class="pane active">
            <div class="bg-blue-900 p-5 rounded-2xl border border-blue-800 shadow-lg mb-6">
                <div class="flex flex-col gap-3">
                    <div class="flex justify-between items-center text-white font-black text-[10px] uppercase tracking-widest">
                        <span>Group Sync Control</span>
                        <div id="pin-badge-list" class="flex flex-wrap gap-2"></div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="group-kill-time" class="flex-1 h-12 rounded-xl text-center font-mono text-2xl outline-none" placeholder="Í≥µÏßÄ ÏãúÍ∞Å (Ïòà: 1000)">
                        <button onclick="killPinnedGroupWithTime()" class="bg-orange-500 text-white font-black px-5 py-2 rounded-xl shadow-md hover:bg-orange-600 text-xs transition active:scale-95">üìå ÏùºÍ¥Ñ KILLED</button>
                    </div>
                </div>
            </div>
            <div id="hero-card" class="card text-center py-6 shadow-xl">
                <div id="d-name" class="text-3xl font-black mt-2 leading-none text-blue-900 italic">ÎåÄÍ∏∞ Ï§ë</div>
                <div id="d-timer" class="timer-big font-mono">00:00:00</div>
                <div id="top3-list" class="mt-6 text-left bg-gray-50 p-4 rounded-xl space-y-2 font-mono text-[13px]"></div>
                <div class="mt-4 flex justify-center gap-2"><button class="p-btn bg-gray-200 px-6 py-2 shadow-sm font-black" onclick="copyKakao('all')">üìã Ïπ¥ÌÜ°Ïö© Ï†ÑÏ≤¥ Î≥µÏÇ¨</button></div>
            </div>
        </div>

        <div id="sched" class="pane">
            <div class="flex justify-between items-center mb-4 gap-3">
                <input type="text" id="search-boss" placeholder="ÌïÑÌÑ∞..." class="border rounded-lg px-4 py-2 text-sm flex-1 outline-none" oninput="handleSearch(this.value)">
                <select id="view-mode-sel" class="border rounded-lg px-3 py-2 text-xs font-bold bg-white" onchange="st.viewMode = this.value; save(); renderSched();">
                    <option value="main">Ïò§Îîò (Î≥∏ÏÑ≠)</option>
                    <option value="all">Ïò§Îîò (Î≥∏ÏÑ≠, Ïπ®Í≥µ)</option>
                </select>
                <button onclick="openBulkModal()" class="p-btn bg-slate-700 text-white px-4 py-2 uppercase">Ïª§Ïä§ÌÖÄ Î≥¥Ïä§ Í¥ÄÎ¶¨</button>
            </div>
            <div id="sched-cont"></div>
        </div>

        <div id="calc" class="pane">
            <div class="grid grid-cols-2 gap-4">
                <div class="card shadow-md">
                    <h3 class="font-black mb-6 text-center text-lg italic border-b pb-2">Ï†† Ï†ïÎ∞Ä Î≥¥Ï†ï (ÏûÑÎ∞ïÏàú)</h3>
                    <div class="grid grid-cols-2 gap-2 mb-6 text-center font-mono">
                        <div class="bg-gray-50 p-4 border rounded-xl"><small class="text-gray-400 font-black">REMAIN</small><div id="zc-remain" class="text-2xl font-black">--:--</div></div>
                        <div class="bg-blue-50 p-4 border border-blue-100 rounded-xl"><small class="text-blue-400 font-black">SPAWN</small><div id="zc-preview" class="text-2xl font-black text-red-500">--:--:--</div></div>
                    </div>
                    <select id="zc-sel" class="w-full h-11 border rounded-lg mb-4 font-bold px-3 bg-gray-50"></select>
                    <input type="text" id="zc-in" class="w-full h-14 text-center font-mono text-3xl border-2 border-blue-900 rounded-xl mb-4 bg-blue-50" placeholder="Ïòà: 0230(2ÏãúÍ∞Ñ30Î∂Ñ), 2 30(2Î∂Ñ30Ï¥à)" oninput="updateZenPreview(this.value)">
                    <button class="p-btn active w-full h-14 text-sm font-black" onclick="applyZenCalc('single')">ÏóÖÎç∞Ïù¥Ìä∏</button>
                </div>
                <div class="card shadow-md">
                    <h3 class="font-black mb-6 text-center text-lg italic border-b pb-2 text-red-700">ÍµêÏ†Ñ Í≥ÑÏÇ∞Í∏∞</h3>
                    <div class="grid grid-cols-2 gap-2 mb-10 text-center font-mono">
                        <div class="bg-gray-50 p-6 border rounded-xl"><small class="font-black text-gray-400 uppercase">Elapsed</small><div id="b-elap" class="text-3xl font-black">00:00</div></div>
                        <div class="bg-red-50 p-6 rounded-xl border border-red-100"><small class="font-black text-red-500 uppercase">Predict</small><div id="b-timer" class="text-3xl font-black text-red-600">--:--</div></div>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <button class="p-btn bg-slate-700 text-white h-14" onclick="btl('start')">ÏãúÏûë</button>
                        <button class="p-btn bg-orange-500 text-white h-14" onclick="btl('kwang')">Í¥ë</button>
                        <button class="p-btn active h-14" onclick="btl('kill')">Ïû°Ìûò</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<div id="bulk-modal" class="modal"><div class="modal-content shadow-2xl"><div id="bulk-inner"></div><div class="mt-8 flex justify-end gap-3"><button onclick="closeBulkModal()" class="p-btn bg-gray-100 px-8 py-3">Ï∑®ÏÜå</button><button onclick="applyBulkUpdate()" class="p-btn bg-blue-900 text-white px-10 py-3 font-black">ÏóÖÎç∞Ïù¥Ìä∏</button></div></div></div>
<canvas id="pip-canvas" width="600" height="340" style="display:none;"></canvas>
<video id="pip-video" autoplay muted playsinline style="display:none;"></video>

<script>
/* [Îç∞Ïù¥ÌÑ∞] ÎèÑÍ∑†Îãò ÏöîÏ≤≠ ÏàúÏÑú Î∞è Î™ÖÏπ≠ 100% ÎèôÍ∏∞Ìôî */
const bosses = [
    { w: "ÏöîÌà∞", i: false, b: [{n:"ÌååÎ•¥Î∞î", r:120}, {n:"ÏÖÄÎ°úÎπÑÏïÑ", r:720}, {n:"ÌùêÎãàÎ•¥", r:720}, {n:"ÌéòÌã∞", r:720}, {n:"Î∞îÏö∞Ìã∞", r:120}, {n:"ÎãàÎìúÌò∏Í∑∏", r:1440}, {n:"ÏïºÎ•∏", r:240}, {n:"Ìã∞Î•¥", r:1440}] },
    { w: "ÎãàÎã§", i: false, b: [{n:"ÎùºÏù¥ÎÖ∏Î•¥", r:720}, {n:"ÎπÑÏöîÎ•∏", r:720}, {n:"Ìó§Î•¥Î™®Îìú", r:240}, {n:"Ïä§ÏπºÎùºÎãàÎ•¥", r:120}, {n:"Î∏åÎ•ÄÌûêÎìú", r:720}, {n:"ÎùºÌÉÄÌÜ†Ïä§ÌÅ¨", r:240}, {n:"ÏàòÎìúÎ¶¨", r:720}, {n:"ÌÜ†Î•¥", r:1440}] },
    { w: "ÏïåÎ∏å", i: false, b: [{n:"Ïä§Î∞îÎ•¥Ìä∏", r:240}, {n:"ÎëêÎùºÏä§Î°úÎ•¥", r:480}, {n:"Î™®ÎÑ§Í∞ÄÎ¶Ñ", r:120}, {n:"ÎìúÎùºÏö∞Í∑∏", r:240}, {n:"Íµ¥Î≤†Ïù¥Í∑∏", r:480}, {n:"Ïò§Îîò", r:1440}] },
    { w: "Î¨¥Ïä§Ìé†", i: false, b: [{n:"Î©îÍ∏∞Î•¥", r:120}, {n:"Ïã†ÎßàÎùº", r:720}, {n:"Ìó§Î•¥Í∞ÄÎ¶Ñ", r:120}, {n:"ÌÉïÍ∑∏Î¶¨Ïä§ÎãàÎ•¥", r:240}, {n:"ÏóòÎìúÎ£¨", r:720}, {n:"Ïö∞Î°úÎ≥¥Î°úÏä§", r:1440}, {n:"ÏàòÎ•¥Ìä∏", r:1440}] },
    { w: "ÏïÑÏä§", i: false, b: [{n:"Î∞úÎ¶¨", r:120}, {n:"ÎÖ∏Ìä∏", r:480}, {n:"ÏÉ§Î¨¥ÌÅ¨", r:120}, {n:"Ïä§ÏπºÎìúÎ©îÎ•¥", r:120}, {n:"Í∑∏Î°úÏïÑ", r:1440}, {n:"ÎØ∏ÎØ∏Î•¥", r:240}] },
    { w: "ÎãàÌîå", i: false, b: [{n:"ÌûàÎ°úÌÇ®", r:1440}, {n:"Ìò∏Îìú", r:1440}, {n:"Ìó§Ïù¥Îìú", r:1440}, {n:"ÌîÑÎ†àÏù¥", r:1440}, {n:"Ïù¥ÎØ∏Î•¥", r:1440}] },
    { w: "Î∞îÎÇò", i: false, b: [{n:"ÏóòÎîîÎ•¥", r:1440}, {n:"ÏïàÎÇòÎ•¥ÏóòÎîîÎ•¥", r:1440}, {n:"Ïä§Ïø®Îìú", r:1440}, {n:"Ïä§Ïπ¥Îîî", r:1440}, {n:"ÏóêÍ∏∞Î•¥", r:1440}] },
    { w: "ÎçòÏ†Ñ", i: false, b: [{n:"4Ï∏µ", r:480}, {n:"7Ï∏µ", r:480}, {n:"10Ï∏µ", r:480}, {n:"ÏµúÌïòÏ∏µÍµ¥Î≤†", r:480}, {n:"ÏµúÌïòÏ∏µÍ∞ïÍ∏Ä", r:480}, {n:"ÏµúÌïòÏ∏µÏä§ÎÑ§Î•¥", r:480}] },
    { w: "Ïπ®Í≥µ ÏöîÌà∞", i: true, b: [{n:"Ïπ®Í≥µ ÌååÎ•¥Î∞î", r:120}, {n:"Ïπ®Í≥µ ÏÖÄÎ°úÎπÑÏïÑ", r:720}, {n:"Ïπ®Í≥µ ÌùêÎãàÎ•¥", r:720}, {n:"Ïπ®Í≥µ ÌéòÌã∞", r:720}, {n:"Ïπ®Í≥µ Î∞îÏö∞Ìã∞", r:120}, {n:"Ïπ®Í≥µ ÎãàÎìúÌò∏Í∑∏", r:1440}, {n:"Ïπ®Í≥µ ÏïºÎ•∏", r:240}, {n:"Ïπ®Í≥µ Ìã∞Î•¥", r:1440}] },
    { w: "Ïπ®Í≥µ ÎãàÎã§", i: true, b: [{n:"Ïπ®Í≥µ ÎùºÏù¥ÎÖ∏Î•¥", r:720}, {n:"Ïπ®Í≥µ ÎπÑÏöîÎ•∏", r:720}, {n:"Ïπ®Í≥µ Ìó§Î•¥Î™®Îìú", r:240}, {n:"Ïπ®Í≥µ Ïä§ÏπºÎùºÎãàÎ•¥", r:120}, {n:"Ïπ®Í≥µ Î∏åÎ•ÄÌûêÎìú", r:720}, {n:"Ïπ®Í≥µ ÎùºÌÉÄÌÜ†Ïä§ÌÅ¨", r:240}, {n:"Ïπ®Í≥µ ÏàòÎìúÎ¶¨", r:720}, {n:"Ïπ®Í≥µ ÌÜ†Î•¥", r:1440}] },
    { w: "Ïπ®Í≥µ ÏïåÎ∏å", i: true, b: [{n:"Ïπ®Í≥µ Ïä§Î∞îÎ•¥Ìä∏", r:240}, {n:"Ïπ®Í≥µ ÎëêÎùºÏä§Î°úÎ•¥", r:480}, {n:"Ïπ®Í≥µ Î™®ÎÑ§Í∞ÄÎ¶Ñ", r:120}, {n:"Ïπ®Í≥µ ÎìúÎùºÏö∞Í∑∏", r:240}, {n:"Ïπ®Í≥µ Íµ¥Î≤†Ïù¥Í∑∏", r:480}] },
    { w: "Ïπ®Í≥µ Î¨¥Ïä§Ìé†", i: true, b: [{n:"Ïπ®Í≥µ Î©îÍ∏∞Î•¥", r:120}, {n:"Ïπ®Í≥µ Ïã†ÎßàÎùº", r:720}, {n:"Ïπ®Í≥µ Ìó§Î•¥Í∞ÄÎ¶Ñ", r:120}, {n:"Ïπ®Í≥µ ÌÉïÍ∑∏Î¶¨Ïä§ÎãàÎ•¥", r:240}, {n:"Ïπ®Í≥µ ÏóòÎìúÎ£¨", r:720}] },
    { w: "Ïπ®Í≥µ ÏïÑÏä§", i: true, b: [{n:"Ïπ®Í≥µ Î∞úÎ¶¨", r:120}, {n:"Ïπ®Í≥µ ÎÖ∏Ìä∏", r:480}, {n:"Ïπ®Í≥µ ÏÉ§Î¨¥ÌÅ¨", r:120}, {n:"Ïπ®Í≥µ Ïä§ÏπºÎìúÎ©îÎ•¥", r:120}, {n:"Ïπ®Í≥µ Í∑∏Î°úÏïÑ", r:1440}, {n:"Ïπ®Í≥µ ÎØ∏ÎØ∏Î•¥", r:240}] },
    { w: "Ïπ®Í≥µ ÎãàÌîå", i: true, b: [{n:"Ïπ®Í≥µ ÌûàÎ°úÌÇ®", r:1440}, {n:"Ïπ®Í≥µ Ìò∏Îìú", r:1440}, {n:"Ïπ®Í≥µ Ìó§Ïù¥Îìú", r:1440}, {n:"Ïπ®Í≥µ ÌîÑÎ†àÏù¥", r:1440}, {n:"Ïπ®Í≥µ Ïù¥ÎØ∏Î•¥", r:1440}] },
    { w: "Ïπ®Í≥µ Î∞îÎÇò", i: true, b: [{n:"Ïπ®Í≥µ ÏóòÎîîÎ•¥", r:1440}, {n:"Ïπ®Í≥µ ÏïàÎÇòÎ•¥ÏóòÎîîÎ•¥", r:1440}, {n:"Ïπ®Í≥µ Ïä§Ïø®Îìú", r:1440}, {n:"Ïπ®Í≥µ Ïä§Ïπ¥Îîî", r:1440}, {n:"Ïπ®Í≥µ ÏóêÍ∏∞Î•¥", r:1440}] }
];

const BOSS_RESPAWN_MAP = {}; bosses.forEach(g => g.b.forEach(b => BOSS_RESPAWN_MAP[b.n] = b.r));
let st = { on: true, profile: 'A', timers: [], pins: [], autoRotate: true, viewMode: 'main', battle: { s: null, k: null, est: 0 }, foldState: {}, timeOffsetMs: 0, _keyCache: {} };

/* [ÌïµÏã¨] ÌïòÏù¥Î∏åÎ¶¨Îìú ÌååÏã± ÏóîÏßÑ (ÎèÑÍ∑†Îãò Ï†úÏïà Î∞òÏòÅ) */
function parseSmart(s) {
    if (!s) return 0;
    s = String(s).trim();
    let total = 0;
    
    // (1) ÌïúÍ∏Ä Îã®ÏúÑ Ìè¨Ìï® Ïó¨Î∂Ä (2Ïùº 23ÏãúÍ∞Ñ)
    if (s.match(/[ÏùºÏãúÎ∂ÑÏ¥à]/)) {
        const d = s.match(/(\d+)Ïùº/); const h = s.match(/(\d+)ÏãúÍ∞Ñ|(\d+)Ïãú/); 
        const m = s.match(/(\d+)Î∂Ñ/); const sc = s.match(/(\d+)Ï¥à/);
        if (d) total += parseInt(d[1]) * 86400;
        if (h) total += parseInt(h[1] || h[2]) * 3600;
        if (m) total += parseInt(m[1]) * 60;
        if (sc) total += parseInt(sc[1]);
        return total;
    }

    // (2) Í≥µÎ∞± Íµ¨Î∂Ñ (02 30 -> 2Î∂Ñ 30Ï¥à)
    if (s.includes(' ')) {
        const p = s.split(/\s+/).map(Number);
        if (p.length === 2) return p[0]*60 + p[1]; // MM SS
        if (p.length === 3) return p[0]*3600 + p[1]*60 + p[2]; // HH MM SS
    }

    // (3) Ïó∞ÏÜç Ïà´Ïûê (0230 -> 2ÏãúÍ∞Ñ 30Î∂Ñ)
    const v = parseInt(s.replace(/[^0-9]/g, ''));
    if (v >= 100 && v < 10000) return Math.floor(v/100)*3600 + (v%100)*60; // HH MM
    if (v >= 10000) return Math.floor(v/10000)*3600 + Math.floor((v%10000)/100)*60 + (v%100); // HH MM SS
    return v * 60; // 1~2ÏûêÎ¶¨Îäî Î∂Ñ Îã®ÏúÑ
}

/* [UI/Loop] */
const __dom = { dName:null, dTimer:null, top3:null, bElap:null, bTimer:null };
function cacheDom() { if(!__dom.dName) { __dom.dName=document.getElementById('d-name'); __dom.dTimer=document.getElementById('d-timer'); __dom.top3=document.getElementById('top3-list'); __dom.bElap=document.getElementById('b-elap'); __dom.bTimer=document.getElementById('b-timer'); } }

function loop() {
    if (!st.on) return; cacheDom();
    const now = Date.now() + st.timeOffsetMs;
    for (const tm of st.timers) {
        if (st.autoRotate && now > tm.t) { tm.t += (BOSS_RESPAWN_MAP[tm.n] || 120) * 60 * 1000; tm.lastD = 9999; tm.m10 = tm.m5 = tm.m1 = false; }
        const d = Math.floor((tm.t - now) / 1000);
        const zenEl = document.getElementById(`zen-${safeKey(tm.n)}`);
        if (zenEl) zenEl.innerText = new Date(tm.t).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', hour12:false});
    }
    const upcoming = [...st.timers].sort((a,b) => a.t - b.t).filter(t => t.t > now);
    const next = upcoming[0];
    if (next) { __dom.dName.innerText = next.n; __dom.dTimer.innerText = formatTimerFull(next.t - now); }
    else { __dom.dName.innerText = "ÎåÄÍ∏∞ Ï§ë"; __dom.dTimer.innerText = "00:00:00"; }
    __dom.top3.innerHTML = upcoming.slice(0,3).map((t, i) => `<div class="flex justify-between items-center border-b pb-1"><b>${i+1}. ${t.n}</b><span class="text-blue-900">${formatTimerFull(t.t-now)}</span></div>`).join('') || "ÏòàÏ†ï ÏóÜÏùå";
    if (st.battle.s && !st.battle.k) __dom.bElap.innerText = formatSimple((Date.now()-st.battle.s)/1000);
    else if (st.battle.k) { const rem = st.battle.est - Math.floor((Date.now()-st.battle.k)/1000); __dom.bTimer.innerText = (rem>=0?"":"+")+formatSimple(Math.abs(rem)); }
    drawPIP(upcoming);
}

function renderSched() {
    const cont = document.getElementById('sched-cont'); let html = ''; const timerMap = new Map(st.timers.map(t => [t.n, t]));
    const filterGroups = st.viewMode === 'main' ? bosses.filter(g => !g.i) : bosses;
    filterGroups.forEach(g => {
        html += `<div class="world-section mb-3 border rounded-xl overflow-hidden shadow-sm bg-white"><div class="bg-gray-100 p-2 font-black text-[10px] uppercase cursor-pointer" onclick="toggleFold('${g.w}')"><span>${g.w}</span></div><div class="world-content">`;
        g.b.forEach(b => {
            const tm = timerMap.get(b.n); const zenTxt = tm ? new Date(tm.t).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', hour12:false}) : '--:--';
            html += `<div class="boss-row"><button onclick="togglePin('${b.n}')" class="text-lg">${st.pins.includes(b.n)?'üìå':'üìç'}</button><b class="text-sm truncate">${b.n}</b><input type="text" data-name="${b.n}" class="v-in" placeholder="0230" onkeydown="if(event.key==='Enter') handleEnterNav(this)"><div id="zen-${safeKey(b.n)}" class="zen-time-display">${zenTxt}</div><button onclick="setTimer('${b.n}', ${b.r*60}, 'Kill')" class="bg-blue-900 text-white text-[10px] py-1 rounded">Kill</button><button onclick="delTimer('${b.n}')" class="text-red-400 font-bold">√ó</button></div>`;
        });
        html += `</div></div>`;
    });
    cont.innerHTML = html; updatePinBadges();
}

/* [Í∏∞Îä• Î≥¥Ï°∞] */
function setTimer(n, s, raw) { const t = Date.now() + st.timeOffsetMs + (s * 1000); st.timers = st.timers.filter(x => x.n !== n); st.timers.push({ n, t, lastD: s + 1, m10: false, m5: false, m1: false }); save(); renderSched_Partial(); updateZenSelect(); }
function openBulkModal() {
    const inner = document.getElementById('bulk-inner'); let html = `<h2 class="text-2xl font-black mb-6 italic uppercase">Boss Bulk Edit</h2><table class="w-full text-left"><thead><tr class="bg-gray-50 text-[10px] uppercase border-b"><th class="p-3">Î≥¥Ïä§Î™Ö</th><th class="p-3">ÎÇ®ÏùÄÏãúÍ∞Ñ</th></tr></thead><tbody>`;
    const bossList = st.viewMode === 'main' ? bosses.filter(g => !g.i) : bosses;
    bossList.forEach(g => g.b.forEach(b => html += `<tr><td class="p-3 border-b font-bold">${b.n}</td><td class="p-3 border-b"><input type="text" class="bulk-in v-in w-40" data-name="${b.n}" placeholder="0230"></td></tr>`));
    inner.innerHTML = html + `</tbody></table>`; document.getElementById('bulk-modal').style.display = 'flex';
}
function applyBulkUpdate() { document.querySelectorAll('.bulk-in').forEach(el => { const s = parseSmart(el.value); if (s > 0) setTimer(el.dataset.name, s, el.value); }); closeBulkModal(); }
function closeBulkModal() { document.getElementById('bulk-modal').style.display = 'none'; }
function formatTimerFull(ms) { if (ms < 0) return "00:00:00"; const s = Math.floor(ms / 1000); return `${Math.floor(s/3600).toString().padStart(2,'0')}:${Math.floor((s%3600)/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`; }
function formatSimple(s) { return `${Math.floor(s/60).toString().padStart(2,'0')}:${Math.floor(s%60).toString().padStart(2,'0')}`; }
function safeKey(n) { if (!st._keyCache[n]) st._keyCache[n] = "b" + fnv1a32(String(n)).toString(36); return st._keyCache[n]; }
function fnv1a32(str) { let h = 0x811c9dc5; for (let i=0; i<str.length; i++) { h ^= str.charCodeAt(i); h = (h + ((h << 1) + (h << 4) + (h << 7) + (h << 8) + (h << 24))) >>> 0; } return h >>> 0; }
function save() { localStorage.setItem(`v32_data_${st.profile}`, JSON.stringify({ timers: st.timers, pins: st.pins, auto: st.autoRotate, view: st.viewMode })); }
function switchProfile(p) { st.profile = p; const d = JSON.parse(localStorage.getItem(`v32_data_${p}`)) || {}; st.timers = d.timers || []; st.pins = d.pins || []; st.autoRotate = d.auto !== undefined ? d.auto : true; st.viewMode = d.view || 'main'; renderSched(); document.getElementById('auto-rotate-mode').checked = st.autoRotate; }
function tab(id, el) { document.querySelectorAll('.pane').forEach(p => p.classList.remove('active')); document.getElementById(id).classList.add('active'); document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); el.classList.add('active'); if (id === 'calc') updateZenSelect(); }
function killPinnedGroupWithTime() { const rawTime = document.getElementById('group-kill-time').value.trim(); if (!st.pins.length || !rawTime) return; const val = parseInt(rawTime.replace(/[^0-9]/g, '')); let hh = Math.floor(val/100), mm = val%100; let killDate = new Date(); killDate.setHours(hh, mm, 0, 0); if (killDate.getTime() > Date.now() + 3600000) killDate.setDate(killDate.getDate() - 1); st.pins.forEach(name => { const targetZenTs = killDate.getTime() + ((BOSS_RESPAWN_MAP[name] || 120) * 60 * 1000); setTimer(name, (targetZenTs - Date.now())/1000, ""); }); document.getElementById('group-kill-time').value = ""; }
window.onload = () => { switchProfile('A'); setInterval(loop, 1000); };
function togglePwr() { st.on = !st.on; document.getElementById('pwr').style.color = st.on ? '#16a34a' : '#94a3b8'; document.body.classList.toggle('system-off', !st.on); }
function togglePin(n) { const i = st.pins.indexOf(n); if(i>-1) st.pins.splice(i,1); else st.pins.push(n); save(); renderSched(); updatePinBadges(); }
function updatePinBadges() { const box = document.getElementById('pin-badge-list'); if (box) box.innerHTML = st.pins.map(name => `<span class="bg-blue-800 text-white text-[9px] px-2 py-0.5 rounded font-bold">${name}</span>`).join(''); }
function clearAllPins() { st.pins = []; save(); renderSched(); updatePinBadges(); }
function updateZenSelect() { const zSel = document.getElementById('zc-sel'); if(!zSel) return; const active = [...st.timers].filter(t => t.t > Date.now()).sort((a, b) => a.t - b.t); let h = '<option value="">Î≥¥Ï†ï Î≥¥Ïä§ ÏÑ†ÌÉù (ÏûÑÎ∞ïÏàú)</option>'; active.forEach(tm => h += `<option value="${tm.n}">[${formatTimerFull(tm.t-Date.now())}] ${tm.n}</option>`); zSel.innerHTML = h; }
function renderSched_Partial() { st.timers.forEach(tm => { const el = document.getElementById(`zen-${safeKey(tm.n)}`); if (el) el.innerText = new Date(tm.t).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', hour12:false}); }); }
function btl(type) { const now = Date.now(); if(type==='start') { st.battle.s=now; st.battle.k=null; } else if(type==='kwang') { if(!st.battle.s) return; st.battle.k=now; st.battle.est=Math.floor(((now-st.battle.s)/1000)*0.51); } else if(type==='kill') { st.battle.s=null; st.battle.k=null; } }
function drawPIP(list) { const canvas = document.getElementById('pip-canvas'); const ctx = canvas.getContext('2d'); ctx.fillStyle = "#0f172a"; ctx.fillRect(0, 0, 600, 340); ctx.fillStyle = "#1e293b"; ctx.fillRect(0, 0, 600, 80); if (list.length > 0) { const next = list[0]; const rem = next.t - Date.now(); ctx.textAlign = "center"; ctx.fillStyle = "#ffffff"; ctx.font = "900 48px 'Noto Sans KR'"; ctx.fillText(next.n, 300, 155); ctx.font = "800 100px 'JetBrains Mono'"; ctx.fillText(formatTimerFull(rem), 300, 270); } }
async function togglePIP() { const v = document.getElementById('pip-video'); if (document.pictureInPictureElement) await document.exitPictureInPicture(); else { v.srcObject = document.getElementById('pip-canvas').captureStream(); await v.play(); await v.requestPictureInPicture(); } }
function delTimer(n) { st.timers = st.timers.filter(x => x.n !== n); save(); renderSched(); }
function confirmClear() { if(confirm("Ï¥àÍ∏∞ÌôîÌï©ÎãàÍπå?")) { st.timers = []; save(); renderSched(); } }
function handleSearch(v) { const s = v.toLowerCase(); document.querySelectorAll('.boss-row').forEach(r => r.style.display = r.querySelector('b').innerText.toLowerCase().includes(s) ? 'grid' : 'none'); }
function handleEnterNav(el) { const s = parseSmart(el.value); if (s > 0) setTimer(el.dataset.name, s, el.value); const inputs = Array.from(document.querySelectorAll('.v-in')); const idx = inputs.indexOf(el); for (let i = idx + 1; i < inputs.length; i++) { if (inputs[i].offsetParent !== null) { inputs[i].focus(); inputs[i].select(); break; } } }
function applyZenCalc(mode) { const s = parseSmart(document.getElementById('zc-in').value); if (s <= 0) return; if (mode === 'single') setTimer(document.getElementById('zc-sel').value, s, ""); else st.pins.forEach(name => setTimer(name, s, "")); document.getElementById('zc-in').value = ""; tab('dash', document.querySelector('.nav-item')); }
function addLog(m) { const b = document.getElementById('logs'); const d = document.createElement('div'); d.innerHTML = `<span class="text-gray-500 font-bold font-mono text-[10px]">[${new Date().toLocaleTimeString()}]</span> ${m}`; b.appendChild(d); }
function toggleFold(w) { st.foldState[w] = !st.foldState[w]; save(); renderSched(); }
function copyKakao(mode) { const now = Date.now(); let list = [...st.timers].sort((a, b) => a.t - b.t); if (mode === 'top3') list = list.filter(t => t.t > now).slice(0, 3); if (!list.length) return; const d = new Date(); const mm = String(d.getMonth()+1).padStart(2,'0'); const dd = String(d.getDate()).padStart(2,'0'); let txt = `${mm}.${dd}\n`; list.forEach(t => txt += `${new Date(t.t).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', hour12:false})} ${t.n}\n`); navigator.clipboard.writeText(txt.trim()).then(() => alert("Î≥µÏÇ¨Îê®")); }
</script>
</body>
</html>
