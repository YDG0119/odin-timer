<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ODIN BOSS COMMANDER - SYNC PRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;500;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8e24aa; --accent: #1e88e5; --bg: #f8f9fa;
            --card: #ffffff; --text: #222; --danger: #ff1744;
            --jotun: #3949ab; --nida: #43a047; --alf: #fb8c00; --muspel: #e53935;
            --as: #8e24aa; --nifl: #00acc1; --vana: #7cb342; --dun: #546e7a;
        }

        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* ë„¤ë¹„ê²Œì´ì…˜ */
        nav { width: 70px; background: #fff; border-right: 1px solid #dee2e6; display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 15px; }
        .nav-item { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 10px; cursor: pointer; color: #adb5bd; transition: 0.2s; font-size: 20px; }
        .nav-item.active { background: var(--primary); color: #fff; }

        /* ë©”ì¸ ì˜ì—­ */
        main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        header { height: 50px; background: #fff; border-bottom: 1px solid #dee2e6; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--primary); }
        .content { flex: 1; padding: 20px; overflow-y: auto; }

        .pane { display: none; }
        .pane.active { display: block; }

        /* ëŒ€ì‹œë³´ë“œ */
        .dashboard-layout { display: grid; grid-template-columns: 1fr 320px; gap: 20px; }
        .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .next-box { text-align: center; border: 2px solid var(--accent); padding: 25px; }
        .timer-main { font-family: 'Orbitron', sans-serif; font-size: 3.5em; color: var(--accent); margin: 10px 0; }

        /* ìŠ¤ì¼€ì¤„ëŸ¬ (ì…ë ¥ ìµœì í™”) */
        .world-label { padding: 6px 12px; border-radius: 4px; color: #fff; font-weight: bold; font-size: 0.85em; margin: 15px 0 8px 0; display: inline-block; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        td { padding: 10px; border-bottom: 1px solid #f1f3f5; }
        .boss-name-td { width: 180px; font-weight: 500; }
        input[type="number"] { width: 100px; padding: 8px; border: 2px solid #e9ecef; border-radius: 6px; text-align: center; font-weight: bold; outline: none; transition: 0.2s; }
        input[type="number"]:focus { border-color: var(--primary); background: #fdf2ff; }
        .expected-time { color: #868e96; font-size: 0.9em; font-family: monospace; }

        /* ì•Œë¦¼ ë¡œê·¸ */
        .log-box { height: 300px; overflow-y: auto; font-size: 0.85em; line-height: 1.6; }
        .log-row { border-bottom: 1px solid #f1f3f5; padding: 4px 0; }
        .log-t { color: var(--danger); font-weight: bold; }

        @keyframes pulse { 50% { opacity: 0.7; } }
    </style>
</head>
<body>

<nav>
    <div class="nav-item active" onclick="tab('dash')">ğŸ </div>
    <div class="nav-item" onclick="tab('sched')">ğŸ“…</div>
    <div class="nav-item" onclick="tab('logs')">ğŸ“</div>
    <div class="nav-item" onclick="togglePIP()">ğŸ“º</div>
</nav>

<main>
    <header>ODIN COMMANDER SYNC</header>
    <div class="content">
        <div id="dash" class="pane active">
            <div class="dashboard-layout">
                <div>
                    <div class="card next-box">
                        <div style="font-size:0.9em; color:#666;">NEXT BOSS</div>
                        <div id="main-name" style="font-size:1.8em; font-weight:700; margin-top:5px;">--</div>
                        <div id="main-timer" class="timer-main">00:00:00</div>
                    </div>
                    <div class="card">
                        <h3 style="margin-top:0;">Upcoming</h3>
                        <div id="up-list"></div>
                    </div>
                </div>
                <div>
                    <div class="card">
                        <h3 style="margin-top:0;">Logs</h3>
                        <div id="log-list" class="log-box"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="sched" class="pane">
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2 style="margin:0;">Boss Scheduler</h2>
                    <span style="font-size:0.8em; color:var(--primary);">* ì…ë ¥ í›„ Enterë¥¼ ëˆ„ë¥´ë©´ ì¦‰ì‹œ ì €ì¥ ë° ë‹¤ìŒ ë³´ìŠ¤ë¡œ ì´ë™</span>
                </div>
                <div id="scheduler-body"></div>
            </div>
        </div>
    </div>
</main>

<canvas id="pip-canvas" width="300" height="450" style="display:none;"></canvas>
<video id="pip-video" autoplay muted style="display:none;"></video>

<script>
    // 53ì¢… ë³´ìŠ¤ ë¦¬ìŠ¤íŠ¸ - ìš”ì²­í•˜ì‹  ì •ë ¬ ìˆœì„œ ì¤€ìˆ˜
    const bossDB = [
        { w: "ìš”íˆ°í—¤ì„", c: "var(--jotun)", b: ["íŒŒë¥´ë°”", "ì…€ë¡œë¹„ì•„", "íë‹ˆë¥´", "í˜í‹°", "ë°”ìš°í‹°", "ë‹ˆë“œí˜¸ê·¸", "ì•¼ë£¬", "í‹°ë¥´"] },
        { w: "ë‹ˆë‹¤ë²¨ë¦¬ë¥´", c: "var(--nida)", b: ["ë¼ì´ë…¸ë¥´", "ë¹„ìš”ë¥¸", "í—¤ë¥´ëª¨ë“œ", "ìŠ¤ì¹¼ë¼ë‹ˆë¥´", "ë¸Œë¥€íë“œ", "ë¼íƒ€í† ìŠ¤í¬", "ìˆ˜ë“œë¦¬", "í† ë¥´"] },
        { w: "ì•Œë¸Œí—¤ì„", c: "var(--alf)", b: ["ìŠ¤ë°”ë¥´íŠ¸", "ë‘ë¼ìŠ¤ë¡œë¥´", "ëª¨ë„¤ê°€ë¦„", "ë“œë¼ìš°ê·¸", "êµ´ë² ì´ê·¸", "ì˜¤ë”˜"] },
        { w: "ë¬´ìŠ¤í í•˜ì„", c: "var(--muspel)", b: ["ë©”ê¸°ë¥´", "ì‹ ë§ˆë¼", "í—¤ë¥´ê°€ë¦„", "íƒ•ê·¸ë¦¬ìŠ¤ë‹ˆë¥´", "ì—˜ë“œë£¬", "ìš°ë¡œë³´ë¡œìŠ¤", "ìˆ˜ë¥´íŠ¸"] },
        { w: "ì•„ìŠ¤ê°€ë¥´ë“œ", c: "var(--as)", b: ["ë°œë¦¬", "ë…¸íŠ¸", "ìƒ¤ë¬´í¬", "ìŠ¤ì¹¼ë“œë©”ë¥´", "í™”ì‹ ê·¸ë¡œì•„", "ë¯¸ë¯¸ë¥´"] },
        { w: "ë‹ˆí”Œí•˜ì„", c: "var(--nifl)", b: ["íˆë¡œí‚¨", "í˜¸ë“œ", "í—¤ì´ë“œ", "ëŒ€êµì£¼", "í”„ë ˆì´", "ì´ë¯¸ë¥´"] },
        { w: "ë°”ë‚˜í•˜ì„", c: "var(--vana)", b: ["ì—˜ë””ë¥´", "ì•ˆë‚˜ë¥´ì—˜ë””ë¥´", "ìŠ¤ì¿¨ë“œ", "ìŠ¤ì¹´ë””", "ì—ê¸°ë¥´"] },
        { w: "ë˜ì „", c: "var(--dun)", b: ["ìµœí•˜ì¸µ êµ´ë² ì´ê·¸", "ìµœí•˜ì¸µ ê°•ê¸€ë¡œí‹°", "ìµœí•˜ì¸µ ìŠ¤ë„¤ë¥´", "4ì¸µ ëª¨ë„¤ê°€ë¦„", "7ì¸µ ë“œë¼ìš°ê·¸", "10ì¸µ ë‹¤ì¸í˜ë¡œí¬"] }
    ];

    let timers = JSON.parse(localStorage.getItem('odin_sync_data')) || [];

    // ìŠ¤ì¼€ì¤„ëŸ¬ ë Œë”ë§
    function init() {
        const container = document.getElementById('scheduler-body');
        let html = '';
        bossDB.forEach(group => {
            html += `<div class="world-label" style="background:${group.c}">${group.w}</div>`;
            html += `<table>`;
            group.bosses.forEach(name => {
                html += `
                    <tr>
                        <td class="boss-name-td">${name}</td>
                        <td><input type="number" class="b-input" data-name="${name}" placeholder="ë‚¨ì€ ë¶„"></td>
                        <td class="expected-time" id="exp-${name}">--:--:--</td>
                    </tr>`;
            });
            html += `</table>`;
        });
        container.innerHTML = html;

        // ì—”í„° í‚¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        const inputs = document.querySelectorAll('.b-input');
        inputs.forEach((input, index) => {
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    // 1. í˜„ì¬ ì…ë ¥ê°’ ì¦‰ì‹œ ë°˜ì˜ (ì˜¤ì°¨ ìµœì†Œí™”)
                    saveTimer(input.dataset.name, input.value);
                    input.value = ''; // ì…ë ¥ì°½ ë¹„ìš°ê¸°
                    
                    // 2. ë‹¤ìŒ ì…ë ¥ì°½ìœ¼ë¡œ í¬ì»¤ìŠ¤ ì´ë™
                    if (inputs[index + 1]) inputs[index + 1].focus();
                }
            });
        });
    }

    function saveTimer(name, mins) {
        if (!mins || mins < 0) return;
        const target = Date.now() + (mins * 60000);
        const idx = timers.findIndex(t => t.name === name);
        if (idx > -1) timers[idx].target = target;
        else timers.push({ name, target });
        
        localStorage.setItem('odin_sync_data', JSON.stringify(timers));
        addLog(`${name} ë™ê¸°í™” ì™„ë£Œ (${new Date(target).toLocaleTimeString()})`);
        
        // ìŠ¤ì¼€ì¤„ëŸ¬ì˜ ì˜ˆìƒ ì   ì‹œê°„ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        document.getElementById(`exp-${name}`).innerText = new Date(target).toLocaleTimeString();
    }

    function addLog(msg) {
        const logBox = document.getElementById('log-list');
        const now = new Date().toLocaleTimeString();
        const row = `<div class="log-row"><span class="log-t">[${now}]</span> ${msg}</div>`;
        logBox.innerHTML = row + logBox.innerHTML;
    }

    function tab(id) {
        document.querySelectorAll('.pane').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function update() {
        const now = Date.now();
        timers.sort((a,b) => a.target - b.target);
        timers = timers.filter(t => t.target - now > -600000);

        if(timers.length > 0) {
            const next = timers[0];
            const diff = next.target - now;
            document.getElementById('main-name').innerText = next.name;
            document.getElementById('main-timer').innerText = format(diff);
            if(diff < 0) document.getElementById('main-timer').style.color = 'var(--danger)';
            else document.getElementById('main-timer').style.color = 'var(--accent)';
        }

        document.getElementById('up-list').innerHTML = timers.slice(1, 10).map(t => `
            <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #f1f3f5;">
                <span>${t.name}</span>
                <span style="font-weight:bold; color:var(--primary);">${format(t.target - now)}</span>
            </div>
        `).join('');

        drawPIP();
    }

    function format(ms) {
        if(ms < 0) return "APPEARED";
        const h = Math.floor(ms/3600000);
        const m = Math.floor((ms%3600000)/60000);
        const s = Math.floor((ms%60000)/1000);
        return `${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    // PIP ë¡œì§
    const canvas = document.getElementById('pip-canvas');
    const ctx = canvas.getContext('2d');
    function drawPIP() {
        ctx.fillStyle = "#121212"; ctx.fillRect(0,0,300,450);
        ctx.fillStyle = "#8e24aa"; ctx.font = "bold 18px Arial"; ctx.fillText("ODIN BOSS SYNC", 15, 35);
        timers.slice(0, 10).forEach((t, i) => {
            const d = t.target - Date.now();
            ctx.fillStyle = d < 300000 ? "#ff1744" : "#00e5ff";
            ctx.font = "15px Arial";
            ctx.fillText(`${t.name.padEnd(8)} ${format(d)}`, 15, 75 + (i*35));
        });
    }

    async function togglePIP() {
        const v = document.getElementById('pip-video');
        if (document.pictureInPictureElement) await document.exitPictureInPicture();
        else { v.srcObject = canvas.captureStream(); await v.play(); await v.requestPictureInPicture(); }
    }

    init();
    setInterval(update, 1000);
</script>

</body>
</html>
