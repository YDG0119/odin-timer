<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ODIN BOSS COMMANDER - V11 CUSTOM</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8e24aa; --accent: #1e88e5; --bg: #f4f7f9;
            --card: #ffffff; --text: #2c3e50; --danger: #d32f2f;
            --jotun: #3f51b5; --nida: #43a047; --alf: #ef6c00; --muspel: #c62828;
            --as: #7b1fa2; --nifl: #0097a7; --vana: #689f38; --dun: #455a64;
        }

        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        nav { width: 70px; background: #fff; border-right: 1px solid #dee2e6; display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 15px; }
        .nav-item { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 12px; cursor: pointer; color: #95a5a6; font-size: 20px; }
        .nav-item.active { background: var(--primary); color: #fff; }
        
        main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        header { height: 50px; background: #fff; border-bottom: 1px solid #dee2e6; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--primary); }
        .content { flex: 1; padding: 20px; overflow-y: auto; }
        .pane { display: none; } .pane.active { display: block; }

        /* ê°€ë¡œ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        .world-badge { padding: 4px 10px; border-radius: 4px; color: #fff; font-weight: bold; font-size: 0.8em; margin: 20px 0 10px 0; display: inline-block; }
        .boss-horizontal-grid { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        
        .boss-unit { 
            background: #fff; padding: 10px; border-radius: 8px; border: 1px solid #eee;
            display: flex; align-items: center; gap: 8px; min-width: 320px; flex: 1;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .b-name { width: 90px; font-weight: bold; font-size: 0.9em; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .btn-killed { background: var(--danger); color: white; border: none; padding: 5px 8px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 0.8em; }
        input[type="text"] { width: 100px; padding: 6px; border: 2px solid #e9ecef; border-radius: 5px; text-align: center; font-family: 'Orbitron'; font-weight: bold; }
        input:focus { border-color: var(--accent); outline: none; background: #f0f7ff; }
        .time-display { font-family: monospace; font-size: 0.85em; color: #7f8c8d; min-width: 60px; }

        /* ê´‘ ê³„ì‚°ê¸° ì „ìš© */
        .gwang-card { background: #fff; border-radius: 12px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); max-width: 500px; margin: 0 auto; }
        .gwang-flex { display: flex; gap: 10px; justify-content: center; margin: 20px 0; }
        .g-btn { flex: 1; padding: 15px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; font-size: 1.1em; color: white; }
        .g-start { background: #455a64; } .g-glow { background: #ffa000; } .g-kill { background: #d32f2f; }
        .g-res-box { background: #f8f9fa; border: 2px dashed #ddd; padding: 20px; border-radius: 10px; text-align: center; }
    </style>
</head>
<body>

<nav>
    <div class="nav-item active" onclick="tab('dash')">ğŸ </div>
    <div class="nav-item" onclick="tab('sched')">ğŸ“…</div>
    <div class="nav-item" onclick="tab('calc')">ğŸ§®</div>
    <div class="nav-item" onclick="togglePIP()">ğŸ“º</div>
</nav>

<main>
    <header>ODIN COMMANDER V11: SMART SYNC</header>
    <div class="content">
        <div id="dash" class="pane active">
            <div style="text-align:center; padding:50px;">
                <h1 id="m-name">ëŒ€ìƒ ì„ íƒ ëŒ€ê¸°</h1>
                <h2 id="m-timer" style="font-size:4em; font-family:Orbitron; color:var(--accent);">00:00:00</h2>
            </div>
        </div>

        <div id="sched" class="pane">
            <div id="sched-container"></div>
        </div>

        <div id="calc" class="pane">
            <div class="gwang-card">
                <h2 style="text-align:center;">ğŸ”¥ ê´‘í­í™”(ê´‘) ì •ë°€ ê³„ì‚°ê¸°</h2>
                <select id="g-boss-select" style="width:100%; padding:10px; margin-bottom:10px; border-radius:5px;"></select>
                
                <div class="gwang-flex">
                    <button class="g-btn g-start" onclick="gAction('start')">ì‹œì‘</button>
                    <button class="g-btn g-glow" onclick="gAction('glow')">ê´‘</button>
                    <button class="g-btn g-kill" onclick="gAction('kill')">ì¡í˜</button>
                </div>

                <div class="g-res-box" id="g-res-display">
                    ì‹œê°„ì„ ì¸¡ì •í•˜ë ¤ë©´ [ì‹œì‘]ì„ ëˆ„ë¥´ì„¸ìš”.
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    const bossDB = [
        { w: "ìš”íˆ°í—¤ì„", c: "var(--jotun)", b: [{n:"íŒŒë¥´ë°”", r:120}, {n:"ì…€ë¡œë¹„ì•„", r:720}, {n:"íë‹ˆë¥´", r:720}, {n:"í˜í‹°", r:720}, {n:"ë°”ìš°í‹°", r:120}, {n:"ë‹ˆë“œí˜¸ê·¸", r:1440}, {n:"ì•¼ë£¬", r:240}, {n:"í‹°ë¥´", r:1440}]},
        { w: "ë‹ˆë‹¤ë²¨ë¦¬ë¥´", c: "var(--nida)", b: [{n:"ë¼ì´ë…¸ë¥´", r:720}, {n:"ë¹„ìš”ë¥¸", r:720}, {n:"í—¤ë¥´ëª¨ë“œ", r:240}, {n:"ìŠ¤ì¹¼ë¼ë‹ˆë¥´", r:120}, {n:"ë¸Œë¥€íë“œ", r:720}, {n:"ë¼íƒ€í† ìŠ¤í¬", r:240}, {n:"ìˆ˜ë“œë¦¬", r:720}, {n:"í† ë¥´", r:1440}]},
        { w: "ì•Œë¸Œí—¤ì„", c: "var(--alf)", b: [{n:"ìŠ¤ë°”ë¥´íŠ¸", r:240}, {n:"ë‘ë¼ìŠ¤ë¡œë¥´", r:480}, {n:"ëª¨ë„¤ê°€ë¦„", r:120}, {n:"ë“œë¼ìš°ê·¸", r:240}, {n:"êµ´ë² ì´ê·¸", r:480}, {n:"ì˜¤ë”˜", r:1440}]},
        { w: "ë¬´ìŠ¤í í•˜ì„", c: "var(--muspel)", b: [{n:"ë©”ê¸°ë¥´", r:120}, {n:"ì‹ ë§ˆë¼", r:720}, {n:"í—¤ë¥´ê°€ë¦„", r:120}, {n:"íƒ•ê·¸ë¦¬ìŠ¤ë‹ˆë¥´", r:240}, {n:"ì—˜ë“œë£¬", r:720}, {n:"ìš°ë¡œë³´ë¡œìŠ¤", r:1440}, {n:"ìˆ˜ë¥´íŠ¸", r:1440}]},
        { w: "ì•„ìŠ¤ê°€ë¥´ë“œ", c: "var(--as)", b: [{n:"ë°œë¦¬", r:120}, {n:"ë…¸íŠ¸", r:480}, {n:"ìƒ¤ë¬´í¬", r:120}, {n:"ìŠ¤ì¹¼ë“œë©”ë¥´", r:120}, {n:"í™”ì‹ ê·¸ë¡œì•„", r:1440}, {n:"ë¯¸ë¯¸ë¥´", r:240}]},
        { w: "ë‹ˆí”Œí•˜ì„", c: "var(--nifl)", b: [{n:"íˆë¡œí‚¨", r:1440}, {n:"í˜¸ë“œ", r:1440}, {n:"í—¤ì´ë“œ", r:1440}, {n:"ëŒ€êµì£¼", r:1440}, {n:"í”„ë ˆì´", r:1440}, {n:"ì´ë¯¸ë¥´", r:1440}]},
        { w: "ë°”ë‚˜í•˜ì„", c: "var(--vana)", b: [{n:"ì—˜ë””ë¥´", r:1440}, {n:"ì•ˆë‚˜ë¥´ì—˜ë””ë¥´", r:1440}, {n:"ìŠ¤ì¿¨ë“œ", r:1440}, {n:"ìŠ¤ì¹´ë””", r:1440}, {n:"ì—ê¸°ë¥´", r:1440}]},
        { w: "ë˜ì „", c: "var(--dun)", b: [{n:"ìµœí•˜ì¸µ êµ´ë² ì´ê·¸", r:480}, {n:"ìµœí•˜ì¸µ ê°•ê¸€ë¡œí‹°", r:480}, {n:"ìµœí•˜ì¸µ ìŠ¤ë„¤ë¥´", r:480}, {n:"4ì¸µ ëª¨ë„¤ê°€ë¦„", r:240}, {n:"7ì¸µ ë“œë¼ìš°ê·¸", r:480}, {n:"10ì¸µ ë‹¤ì¸í˜ë¡œí¬", r:480}]}
    ];

    let timers = JSON.parse(localStorage.getItem('odin_v11_timers')) || [];
    let gwangData = { start: null, glow: null, boss: null };

    function init() {
        const container = document.getElementById('sched-container');
        const select = document.getElementById('g-boss-select');
        let html = '';
        
        bossDB.forEach(group => {
            html += `<div class="world-badge" style="background:${group.c}">${group.w}</div><div class="boss-horizontal-grid">`;
            group.b.forEach(boss => {
                const savedVal = localStorage.getItem(`v11_input_${boss.n}`) || '';
                html += `
                    <div class="boss-unit">
                        <span class="b-name">${boss.n}</span>
                        <button class="btn-killed" onclick="autoKilled('${boss.n}', ${boss.r})">ì¡ìŒ</button>
                        <input type="text" class="b-input-sync" data-name="${boss.n}" value="${savedVal}" placeholder="ì‹œ ë¶„ ì´ˆ">
                        <span class="time-display" id="display-${boss.n}">--:--</span>
                    </div>`;
                select.innerHTML += `<option value="${boss.n}">${boss.n}</option>`;
            });
            html += `</div>`;
        });
        container.innerHTML = html;

        // ì—”í„° í‚¤ í•¸ë“¤ëŸ¬ (ê°€ë¡œ ì´ë™ í›„ ë‹¤ìŒ ì¤„ ì´ë™)
        const inputs = document.querySelectorAll('.b-input-sync');
        inputs.forEach((input, i) => {
            input.addEventListener('keydown', (e) => {
                if(e.key === 'Enter') {
                    // ì¦‰ì‹œ ì ìš© ë¡œì§ í˜¸ì¶œ
                    const sec = smartParse(input.value);
                    if(sec > 0) saveTimer(input.dataset.name, sec, input.value);
                    
                    // ë‹¤ìŒ ì¹¸ ì´ë™
                    if(inputs[i+1]) inputs[i+1].focus();
                }
            });
        });
    }

    // [ì¡ìŒ] ë²„íŠ¼ í´ë¦­ ì‹œ ë¡œì§ ìˆ˜ì •
    function autoKilled(name, regenMins) {
        // ì¦‰ì‹œ í˜„ì¬ ì‹œê°„ + ë¦¬ì   ì£¼ê¸°ë¡œ ì ìš©
        const target = Date.now() + (regenMins * 60000);
        saveTimer(name, (regenMins * 60), "ìë™(ì¡ìŒ)");
    }

    // ê´‘ ê³„ì‚°ê¸° í•µì‹¬ ë¡œì§
    function gAction(type) {
        const display = document.getElementById('g-res-display');
        const bossName = document.getElementById('g-boss-select').value;
        const now = Date.now();

        if(type === 'start') {
            gwangData.start = now;
            display.innerHTML = `ì‚¬ëƒ¥ ì‹œì‘: <b>${new Date(now).toLocaleTimeString()}</b><br>ë³´ìŠ¤ê°€ ê´‘í­í™”(ê´‘)ê°€ ëœ¨ë©´ [ê´‘] ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.`;
        } else if(type === 'glow') {
            if(!gwangData.start) return alert("ì‹œì‘ ë²„íŠ¼ì„ ë¨¼ì € ëˆŒëŸ¬ì£¼ì„¸ìš”.");
            gwangData.glow = now;
            const diffMin = Math.floor((now - gwangData.start)/60000);
            const diffSec = Math.floor(((now - gwangData.start)%60000)/1000);
            display.innerHTML = `ê´‘í­í™” ë„ë‹¬! (ì†Œìš”: ${diffMin}ë¶„ ${diffSec}ì´ˆ)<br>ë³´ìŠ¤ë¥¼ ì¡ìœ¼ë©´ [ì¡í˜] ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.`;
        } else if(type === 'kill') {
            if(!gwangData.glow) return alert("ê´‘ ë²„íŠ¼ì„ ë¨¼ì € ëˆŒëŸ¬ì£¼ì„¸ìš”.");
            // ë¦¬ì   ì£¼ê¸° ì°¾ê¸°
            let regen = 120;
            bossDB.forEach(g => g.b.forEach(b => { if(b.n === bossName) regen = b.r; }));
            
            const nextZen = now + (regen * 60000);
            saveTimer(bossName, (regen * 60), "ê´‘ê³„ì‚° ë°˜ì˜");
            display.innerHTML = `ğŸ‰ ì²˜ì¹˜ ì™„ë£Œ! ë‹¤ìŒ ì   ë°˜ì˜ë¨: <b>${new Date(nextZen).toLocaleTimeString()}</b>`;
            gwangData = { start: null, glow: null, boss: null };
        }
    }

    // ê³µí†µ ì €ì¥ ë° íŒŒì‹± í•¨ìˆ˜
    function saveTimer(name, sec, raw) {
        const target = Date.now() + (sec * 1000);
        const idx = timers.findIndex(t => t.n === name);
        if(idx > -1) timers[idx].t = target; else timers.push({ n: name, t: target });
        localStorage.setItem('odin_v11_timers', JSON.stringify(timers));
        localStorage.setItem(`v11_input_${name}`, raw);
        updateDisplay();
    }

    function smartParse(str) {
        if(!str) return 0;
        const p = str.split(/[:\s]+/).filter(x => x !== "").map(Number);
        if(p.length === 3) return (p[0] * 3600) + (p[1] * 60) + p[2];
        if(p.length === 2) return (p[0] * 60) + p[1];
        if(p.length === 1) return p[0] * 60;
        return 0;
    }

    function updateDisplay() {
        const now = Date.now();
        timers.sort((a,b) => a.t - b.t);
        if(timers.length > 0) {
            document.getElementById('m-name').innerText = timers[0].n;
            document.getElementById('m-timer').innerText = format(timers[0].t - now);
        }
        timers.forEach(t => {
            const el = document.getElementById(`display-${t.n}`);
            if(el) el.innerText = new Date(t.t).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        });
    }

    function format(ms) {
        if(ms < 0) return "GEN!";
        const h = Math.floor(ms/3600000); const m = Math.floor((ms%3600000)/60000); const s = Math.floor((ms%60000)/1000);
        return `${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    function tab(id) {
        document.querySelectorAll('.pane').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    init();
    setInterval(updateDisplay, 1000);
</script>
</body>
</html>
